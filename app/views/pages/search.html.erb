<%= render partial: "cookielaw" %>

<%= render partial: "header" %>

<div class="row small-up-1 medium-up-3">
    
    <% @tags.each do |tag| %>

      <% if tag.taggable_type == 'Page'
        page = Page.find_by id: tag.taggable_id
        if page && page.visibile
          abstract = page.abstract
          anno = page.published_at.year

          # verifichiamo se esiste almeno una foto associata all'articolo
          foto = ColumnImage.joins(:column => :row).where(:rows => {:page_id => page}).first
      %>
       <div class="column column-block">
          <div class="card-user-profile">
            <% if foto.immagine.exists? %>
                <a href="<%= "/#{page.slug}" %>">    
                    <img class="card-user-profile-img" src="<%= foto.immagine.url(:thumb) %>" />
                </a>
            <% end %>
            <div class="card-user-profile-content card-section">
                <p class="card-user-profile-name"><a href="<%= "/#{page.slug}" %>"><%= page.titolo %></a></p>
                <p class="card-user-profile-date">del <%= page.published_at.to_s(:data) %>
                   <% if !page.section.principale %><br>da sezione <%= page.section.titolo %><% end %>
                </p>
                <p class="card-user-profile-info"><%= abstract %></p>
            </div>
         </div>
      </div>
      <%
        end
        elsif tag.taggable_type == 'Attachment'
          attachment = Attachment.find_by id: tag.taggable_id
          if attachment
      %>
            <div class="expanded row">
              <div class="large-2 columns">
                <a href="<%= "/attachments/#{ attachment.id }/download/#{attachment.allegato_file_name}" %>"><%= image_tag "/img/formati/#{ File.extname(attachment.allegato_file_name).gsub('.','') }.png", class: 'show-for-medium', style: 'width: 100%;' %></a>
              </div>
              <div class="large-10 columns"><span class="titolo-ricerca"><%= link_to attachment.titolo.mb_chars.upcase, "/attachments/#{ attachment.id }/download/#{attachment.allegato_file_name}" %></span>
                <p><span class="info-ricerca">file: <b><%= attachment.allegato_file_name %>, <%= attachment.allegato_file_size / 1024 %> KB</b>, data <b><%= attachment.updated_at.to_s(:data) %></b>, sezione <b><%= attachment.section.titolo %></b></span>
                  <br><span class="descrizione-ricerca"><%= attachment.descrizione %></span></p>
              </div>
            </div>
      <%
          end
        elsif tag.taggable_type == 'Photoalbum'
          photoalbum = Photoalbum.find_by id: tag.taggable_id
          if photoalbum
      %>
            <div class="expanded row">
              <div class="large-2 columns">
                <a href="<%= "/photoalbums/#{ photoalbum.id }" %>"><%=
                  if photoalbum.copertina
                    photo = Photo.find_by(id: photoalbum.copertina)
                    if photo
                      image_tag photo.immagine.thumb.url, class: 'show-for-medium', style: 'width: 100%;'
                    end
                  end
                %></a>
              </div>
              <div class="large-10 columns"><span class="titolo-ricerca"><%= link_to photoalbum.titolo.mb_chars.upcase, "/photoalbums/#{ photoalbum.id }" %></span>
                <p><span class="info-ricerca">data <b><%= photoalbum.updated_at.to_s(:data) %></b>, sezione <b><%= photoalbum.section.titolo %></b></span>
                </p>
              </div>
            </div>
        <%
          end
        end
      end
      %>

</div>    
    
<div class="text-center">
<%= will_paginate @tags, renderer: FoundationPagination::Rails %>
</div>
     
<%= render partial: "footer" %>
